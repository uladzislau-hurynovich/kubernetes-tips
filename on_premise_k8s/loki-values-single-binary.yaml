# Loki single-binary mode for staging logs ingestion.

loki:
  auth_enabled: false
  commonConfig:
    replication_factor: 1
  schemaConfig:
    configs:
      - from: "2024-01-01"
        store: tsdb
        object_store: filesystem
        schema: v13
        index:
          prefix: loki_index_
          period: 24h
  storage:
    type: filesystem

deploymentMode: SingleBinary

singleBinary:
  replicas: 1
  persistence:
    size: 4Gi
    storageClass: nfs-client
backend:
  replicas: 0
read:
  replicas: 0
write:
  replicas: 0

gateway:
  enabled: false

# Disable memcached caches so we don't need ~10GB nodes (chunks-cache requests 9830Mi).
chunksCache:
  enabled: false
resultsCache:
  enabled: false
memcached:
  enabled: false

monitoring:
  serviceMonitor:
    enabled: true

# Run canary DaemonSet on all Linux nodes (including Karpenter controller node).
lokiCanary:
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
          - matchExpressions:
              - key: kubernetes.io/os
                operator: In
                values:
                  - linux
  tolerations:
    - key: karpenter.sh/controller
      operator: Exists
      effect: NoSchedule
    - key: CriticalAddonsOnly
      operator: Exists
      effect: NoSchedule

